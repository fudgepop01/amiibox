var __awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(s,a)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};fudgeapps.loadBundle("a9ftqrot",["exports"],function(e){var t=window.fudgeapps.h;function i(e){return!(!e||!e.content)}var n=function(){function e(e){this.parent=e,this.added=new Uint8Array,this.pieces=[],this.chunk="",this.original=e.file,this.pieces=[{offset:0,length:this.original.length,source:"origin"}]}return e.prototype.initEdit=function(e,t){var i,n;if(this.inProgress={offset:e,type:t,content:[],index:-1,get length(){return this.content.length}},"insert"===t){for(var r=0,o=void 0,s=void 0,a=void 0,l=0,h=this.pieces.entries();l<h.length;l++){var c=h[l],u=c[0];if((r+=(g=c[1]).length)>=e){o=g.length-r+e,s=u,a=g;break}}this.inProgress.index=s+1,(i=this.pieces).splice.apply(i,[s,1].concat([{offset:a.offset,length:o,source:a.source},this.inProgress,{offset:a.offset+o,length:a.length-o,source:a.source}]))}else{r=0,o=void 0,s=void 0,a=void 0;for(var d=0,p=this.pieces.entries();d<p.length;d++){var g,f=p[d];if(u=f[0],(r+=(g=f[1]).length)>=e){o=g.length-r+e,s=u,a=g;break}}this.inProgress.index=s+1,(n=this.pieces).splice.apply(n,[s,1].concat([{offset:a.offset,length:o,source:a.source},this.inProgress,{offset:a.offset+o,length:a.length-o,source:a.source}]))}},e.prototype.buildEdit=function(e){if(/^[a-fA-F0-9]$/.test(e.key)&&(this.chunk+=e.key,2===this.chunk.length)){this.inProgress.content.push(parseInt(this.chunk,16)),this.chunk="",this.parent.setCursorPosition(this.parent.cursor+1);var t=this.pieces.indexOf(this.inProgress);if("overwrite"===this.inProgress.type&&t!==this.pieces.length-1){var i=this.pieces[t+1];i.offset+=1,i.length-=1,0===i.length&&this.pieces.splice(t+1,1)}}},e.prototype.commit=function(){var e=new Uint8Array(this.added.length+this.inProgress.content.length);e.set(this.added,0),e.set(this.inProgress.content,this.added.length),this.pieces[this.inProgress.index]={offset:this.added.length,length:this.inProgress.length,source:"added"},this.added=e,this.inProgress=null,this.chunk=""},e.prototype.render=function(e,t){for(var n,r=new Uint8Array(t),o={added:[]},s=0,a=0,l=0,h=this.pieces.entries();l<h.length;l++){var c=h[l],u=c[0];if((s+=(p=c[1]).length)>=e){n=p.length-s+e,a=u;break}}(i(this.pieces[a])||"added"===this.pieces[a].source)&&o.added.push([e-n,e-n+this.pieces[a].length]);var d=this.getPieceBuffer(this.pieces[a]).subarray(n,n+t);for(s=d.length,r.set(d,0),u=a+1;u<this.pieces.length;u++){var p;if(s+=(p=this.pieces[u]).length,(i(p)||"added"===p.source)&&o.added.push([e+s-p.length,e+s]),s>=t){r.set(this.getPieceBuffer(p).subarray(0,p.length-s+t),s-p.length);break}r.set(this.getPieceBuffer(p),s-p.length)}return s!==t?{out:r.subarray(0,s),meta:o}:{out:r,meta:o}},Object.defineProperty(e.prototype,"length",{get:function(){for(var e=0,t=0,i=this.pieces;t<i.length;t++)e+=i[t].length;return e},enumerable:!0,configurable:!0}),e.prototype.rollback=function(){},e.prototype.save=function(){return this.render(0,this.length).out},e.prototype.getPieceBuffer=function(e){return i(e)?new Uint8Array(e.content):"origin"===e.source?this.original.subarray(e.offset,e.offset+e.length):this.added.subarray(e.offset,e.offset+e.length)},e}(),r=function(){function e(){var e=this;this.lineNumber=0,this.displayAscii=!0,this.maxLines=30,this.bytesPerLine=16,this.bytesUntilForcedLine=0,this.asciiInline=!1,this.bytesPerGroup=4,this.mode="edit",this.editType="overwrite",this.regionDepth=2,this.regions=[],this.scroll=function(t){t.preventDefault();var i=Number.isInteger(t.deltaY)?Math.ceil(t.deltaY/2):Math.ceil(t.deltaY/100);-0===i&&(i-=1),e.lineNumber+i<0?e.lineNumber=0:e.lineNumber+i>Math.floor(e.editController.length/e.bytesPerLine)-1?e.lineNumber=Math.floor(e.editController.length/e.bytesPerLine)-1:e.lineNumber+=i}}return e.prototype.componentWillLoad=function(){this.file=new Uint8Array(32),this.editController=new n(this),this.regionScaleWidth=28,this.regionScaleHeight=17},e.prototype.componentDidLoad=function(){this.hexLoaded.emit(this.editController)},e.prototype.acceptFile=function(e){return __awaiter(this,void 0,void 0,function(){var t,i=this;return __generator(this,function(r){return console.log(e),this.fileMetadata=e,(t=new FileReader).readAsArrayBuffer(e),t.onload=function(e){i.file=new Uint8Array(e.target.result),i.editController=new n(i)},[2]})})},e.prototype.saveFile=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return null==this.file?[2]:[2,this.editController.save()]})})},e.prototype.setLineNumber=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.lineNumber=e,this.hexLineChanged.emit(e),[2]})})},e.prototype.setCursorPosition=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.cursor=e,[2]})})},e.prototype.setSelection=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.selection=Object.assign({},this.selection,e),[2]})})},e.prototype.getChunk=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return[2,this.editController.render(e,t)]})})},e.prototype.getFileMetadata=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.fileMetadata]})})},e.prototype.buildHexView=function(){for(var e=this,i=this,n=i.lineNumber,r=i.maxLines,o=i.bytesPerLine,s=i.bytesPerGroup,a=i.asciiInline,l=n*o,h=this.editController.render(l,r*o),c=h.out,u=h.meta.added,d=[],p=0;p<r;p++)d.push(c.subarray(p*o,(p+1)*o));for(var g=[],f=[],b=0,y=d.entries();b<y.length;b++){var m=y[b],v=m[0],w=m[1];if(0===w.length)break;for(var P=l+v*o,x=[],L=[],S="•",_=!1,C=0,k=w.values().slice().entries();C<k.length;C++){var M,B=k[C],E=B[0],A=B[1];S=/\w|[!@#$%^&*()_+=\]\\:;"'>.<,\/?]/.test(String.fromCharCode(A))?String.fromCharCode(A):"•",M=a&&/\w/.test(S)?"."+S:A.toString(16).toUpperCase().padStart(2,"0");var N=[];E%s==s-1&&N.push("padByte"),this.cursor===P+E&&(N.push("cursor"),_=!0),this.selection&&this.selection.start<=P+E&&P+E<=this.selection.end&&N.push("selected");for(var H=0,O=u;H<O.length;H++){var U=O[H];if(U[0]<=P+E&&P+E<U[1]){N.push("added");break}}x.push(t("span",{class:N.join(" ")},S)),L.push(t("span",{class:N.join(" ")},M))}g.push(t("div",{class:"hexLine"+(_?" selected":"")},L)),f.push(t("div",{class:"charLine"+(_?" selected":"")},x))}for(;g.length<r;)g.push(t("div",{class:"hexLine",style:{pointerEvents:"none"}},t("span",null,"-"))),f.push(t("div",{class:"charLine",style:{pointerEvents:"none"}},t("span",null,"-")));var F=[];for(p=0;p<r;p++)F.push(t("div",{class:"lineLabel",style:{pointerEvents:"none"}},"0x"+(l+p*o).toString(16).padStart(8," ")));for(var D=[],R=function(i,r,o){if(void 0===r&&(r=0),i.end<l||i.start>l+e.maxLines*e.bytesPerLine){if(i.subRegions&&r+1!==e.regionDepth)for(var s=0,a=i.subRegions.entries();s<a.length;s++){var h=a[s];R(h[1],r+1,h[0])}}else if(r!==e.regionDepth){var c=i.start%e.bytesPerLine,u=i.end%e.bytesPerLine,d=Math.floor((i.end-i.start+c)/e.bytesPerLine),p=Math.floor(i.start/e.bytesPerLine)-n;if(D.push(t("polygon",{onmousemove:"\n            if (window.canUpdateMousemove === undefined) {\n              window.canUpdateMousemove = true;\n            }\n            if (window.canUpdateMousemove) {\n              window.canUpdateMousemove = false;\n              document.documentElement.style.setProperty('--mouse-x', event.clientX);\n              document.documentElement.style.setProperty('--mouse-y', event.clientY);\n              document.getElementById('tooltip').setAttribute('active', true)\n              document.getElementById('tooltip').setAttribute('complex', '"+JSON.stringify(Object.assign({},i,{subRegions:i.subRegions?i.subRegions.map(function(e){return e.name}):null}))+"');\n\n              setTimeout(() => {window.canUpdateMousemove = true}, 50);\n            }\n          ",onmouseleave:"document.getElementById('tooltip').setAttribute('active', false)",class:"region",points:"\n            0,"+(1+p)*e.regionScaleHeight+"\n            "+c*e.regionScaleWidth+","+(1+p)*e.regionScaleHeight+"\n            "+c*e.regionScaleWidth+","+p*e.regionScaleHeight+"\n            "+e.bytesPerLine*e.regionScaleWidth+","+p*e.regionScaleHeight+"\n            "+e.bytesPerLine*e.regionScaleWidth+","+(d+p)*e.regionScaleHeight+"\n            "+u*e.regionScaleWidth+","+(d+p)*e.regionScaleHeight+"\n            "+u*e.regionScaleWidth+","+(d+p+1)*e.regionScaleHeight+"\n            0,"+(d+1+p)*e.regionScaleHeight+"\n            ",fill:i.color||{0:["#88F","#BBF"],1:["#F88","#FBB"],2:["#8D8","#BDB"]}[r%3][o%2],stroke:"none"})),i.subRegions&&r+1!==e.regionDepth)for(var g=0,f=i.subRegions.entries();g<f.length;g++){var b=f[g];R(b[1],r+1,b[0])}}},j=0,W=this.regions.entries();j<W.length;j++){var I=W[j];R(I[1],0,p=I[0])}return{lineViews:g,charViews:f,lineLabels:F,regionMarkers:t("svg",{viewbox:"0 0 "+this.bytesPerLine*this.regionScaleWidth+" "+this.maxLines*this.regionScaleHeight,width:""+this.bytesPerLine*this.regionScaleWidth,height:""+this.maxLines*this.regionScaleHeight},D)}},e.prototype.edit=function(e){if("readonly"!==this.editType){var t=this.editController;t.inProgress||t.initEdit(this.cursor,this.editType),t.buildEdit(e)}},e.prototype.showHex=function(){var e=this,i=this.buildHexView(),n=i.lineViews,r=i.charViews,o=i.lineLabels,s=i.regionMarkers;return t("div",{class:"hex",onMouseEnter:function(t){return e._toggleScrollListener(t)},onMouseLeave:function(t){return e._toggleScrollListener(t)},onMouseDown:function(t){return e.beginSelection(t)},onMouseUp:function(t){return e.endSelection(t)},tabindex:"0",onKeyDown:function(t){return e.edit(t)}},t("div",{id:"MEASURE",class:"hex",style:{position:"absolute",visibility:"hidden",padding:"0 5px"}},"AB"),t("div",{class:"lineLabels"},o),t("div",{class:"hexView"},t("div",{class:"highlight",style:{position:"absolute",top:"0",display:"noregion"===this.mode?"none":"block",zIndex:"region"===this.mode?"3":"0"}},s),t("div",{class:"main"},n)),this.displayAscii?t("div",{class:"asciiView"},r):null)},e.prototype.beginSelection=function(e){"HEX-SCROLLBAR"!==e.target.id&&(this.tempSelection=this.lineNumber*this.bytesPerLine+e.composedPath()[2].children.slice().indexOf(e.composedPath()[1])*this.bytesPerLine+e.composedPath()[1].children.slice().indexOf(e.composedPath()[0]))},e.prototype.endSelection=function(e){if("HEX-SCROLLBAR"!==e.target.id){var t=this.lineNumber*this.bytesPerLine+e.composedPath()[2].children.slice().indexOf(e.composedPath()[1])*this.bytesPerLine+e.composedPath()[1].children.slice().indexOf(e.composedPath()[0]);this.selection=this.tempSelection>t?{start:t,end:this.tempSelection}:{start:this.tempSelection,end:t},this.tempSelection=null,this.cursor=t,this.hexCursorChanged.emit(this.cursor),this.hexSelectionChanged.emit(this.selection),this.editController.inProgress&&(this.editController.commit(),this.hexDataChanged.emit())}},e.prototype.render=function(){return t("div",{class:"fudgedit-container"},this.showHex())},e.prototype._toggleScrollListener=function(e){"mouseenter"===e.type?e.target.addEventListener("wheel",this.scroll,{passive:!1}):e.target.removeEventListener("wheel",this.scroll,!1)},Object.defineProperty(e,"is",{get:function(){return"fudge-hex-editor"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{acceptFile:{method:!0},asciiInline:{type:Boolean,attr:"ascii-inline"},bytesPerGroup:{type:Number,attr:"bytes-per-group"},bytesPerLine:{type:Number,attr:"bytes-per-line"},bytesUntilForcedLine:{type:Number,attr:"bytes-until-forced-line"},cursor:{state:!0},displayAscii:{type:Boolean,attr:"display-ascii"},editType:{type:String,attr:"edit-type"},file:{state:!0},fileMetadata:{state:!0},getChunk:{method:!0},getFileMetadata:{method:!0},lineNumber:{state:!0},maxLines:{type:Number,attr:"max-lines"},mode:{type:String,attr:"mode"},regionDepth:{type:Number,attr:"region-depth"},regions:{type:"Any",attr:"regions"},saveFile:{method:!0},selection:{state:!0},setCursorPosition:{method:!0},setLineNumber:{method:!0},setSelection:{method:!0}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"hexLineChanged",method:"hexLineChanged",bubbles:!0,cancelable:!0,composed:!0},{name:"hexCursorChanged",method:"hexCursorChanged",bubbles:!0,cancelable:!0,composed:!0},{name:"hexSelectionChanged",method:"hexSelectionChanged",bubbles:!0,cancelable:!0,composed:!0},{name:"hexDataChanged",method:"hexDataChanged",bubbles:!0,cancelable:!0,composed:!0},{name:"hexLoaded",method:"hexLoaded",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return".fudgedit-container{overflow:hidden;position:relative;min-height:100%;color:#000}.hex{font-family:Sourcecode Pro,Courier,monospace;font-size:15px;height:100%;outline:none}.asciiView,.hexView,.lineLabels{display:inline-block;padding:0 10px;white-space:pre;position:relative}.charLine span,.hexLine span{position:relative;height:17px;display:inline-block}.lineLabel{height:17px}.hexLine span{position:relative;padding:0 5px;width:28px;-webkit-box-sizing:border-box;box-sizing:border-box}.hexLine span:not(:last-child).padByte:after{background-color:rgba(0,0,0,.4);position:absolute;width:2px;height:100%;left:calc(100% - 1px);content:\"\"}.hexLine span{cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.charLine span.selected,.hexLine span.selected{background-color:rgba(136,136,255,.5)}.charLine span.cursor,.hexLine span.cursor{background-color:#008;color:#fff}.charLine span.added,.hexLine span.added{color:red}.hexLine span:hover{background-color:#000;color:#fff}.charLine:nth-child(2n-1),.hexLine:nth-child(2n-1),.lineLabel:nth-child(2n-1){background-color:#eff}.charLine.selected,.hexLine.selected{background-color:#ffa}.region{opacity:1}.highlight{mix-blend-mode:multiply}.region{position:relative}.highlight:hover .region:not(:hover){fill:rgba(0,0,0,.2)}"},enumerable:!0,configurable:!0}),e}();e.FudgeHexEditor=r,Object.defineProperty(e,"__esModule",{value:!0})});